(function(){var d=tinymce.explode("id,name,width,height,style,align,class,hspace,vspace,bgcolor,type"),h=tinymce.makeMap(d.join(",")),c=tinymce.html.Node,f,e,g=tinymce.util.JSON,a;f=[["Flash","d27cdb6e-ae6d-11cf-96b8-444553540000","application/x-shockwave-flash","http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"],["ShockWave","166b1bca-3f9c-11cf-8075-444553540000","application/x-director","http://download.macromedia.com/pub/shockwave/cabs/director/sw.cab#version=8,5,1,0"],["WindowsMedia","6bf52a52-394a-11d3-b153-00c04f79faa6,22d6f312-b0f6-11d0-94ab-0080c74c7e95,05589fa1-c356-11ce-bf01-00aa0055595a","application/x-mplayer2","http://activex.microsoft.com/activex/controls/mplayer/en/nsmp2inf.cab#Version=5,1,52,701"],["QuickTime","02bf25d5-8c17-4b23-bc80-d3488abddc6b","video/quicktime","http://www.apple.com/qtactivex/qtplugin.cab#version=6,0,2,0"],["RealMedia","cfcdaa03-8be4-11cf-b84b-0020afbbccfa","audio/x-pn-realaudio-plugin","http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"],["Java","8ad9c840-044e-11d1-b3e9-00805f499d93","application/x-java-applet","http://java.sun.com/products/plugin/autodl/jinstall-1_5_0-windows-i586.cab#Version=1,5,0,0"],["Silverlight","dfeaf541-f3e1-4c24-acac-99c30715084a","application/x-silverlight-2"],["Iframe"],["Video"]];function b(m){var l,j,k;if(m&&!m.splice){j=[];for(k=0;true;k++){if(m[k]){j[k]=m[k]}else{break}}return j}return m}tinymce.create("tinymce.plugins.MediaPlugin",{init:function(n,l){var q=this,o={},m,p,r,k;function j(i){return i&&i.nodeName==="IMG"&&n.dom.hasClass(i,"mceItemMedia")}q.editor=n;q.url=l;e="";for(m=0;m<f.length;m++){k=f[m][0];r={name:k,clsids:tinymce.explode(f[m][1]||""),mimes:tinymce.explode(f[m][2]||""),codebase:f[m][3]};for(p=0;p<r.clsids.length;p++){o["clsid:"+r.clsids[p]]=r}for(p=0;p<r.mimes.length;p++){o[r.mimes[p]]=r}o["mceItem"+k]=r;o[k.toLowerCase()]=r;e+=(e?"|":"")+k}tinymce.each(n.getParam("media_types","video=mp4,m4v,ogv,webm;silverlight=xap;flash=swf,flv;shockwave=dcr;quicktime=mov,qt,mpg,mp3,mpeg;shockwave=dcr;windowsmedia=avi,wmv,wm,asf,asx,wmx,wvx;realmedia=rm,ra,ram;java=jar").split(";"),function(v){var t,s,u;v=v.split(/=/);s=tinymce.explode(v[1].toLowerCase());for(t=0;t<s.length;t++){u=o[v[0].toLowerCase()];if(u){o[s[t]]=u}}});e=new RegExp("write("+e+")\\(([^)]+)\\)");q.lookup=o;n.onPreInit.add(function(){n.schema.addValidElements("object[id|style|width|height|classid|codebase|*],param[name|value],embed[id|style|width|height|type|src|*],video[*],audio[*],source[*]");n.parser.addNodeFilter("object,embed,video,audio,script,iframe",function(s){var t=s.length;while(t--){q.objectToImg(s[t])}});n.serializer.addNodeFilter("img",function(s,u,t){var v=s.length,w;while(v--){w=s[v];if((w.attr("class")||"").indexOf("mceItemMedia")!==-1){q.imgToObject(w,t)}}})});n.onInit.add(function(){if(n.theme&&n.theme.onResolveName){n.theme.onResolveName.add(function(i,s){if(s.name==="img"&&n.dom.hasClass(s.node,"mceItemMedia")){s.name="media"}})}if(n&&n.plugins.contextmenu){n.plugins.contextmenu.onContextMenu.add(function(i,t,s){if(s.nodeName==="IMG"&&s.className.indexOf("mceItemMedia")!==-1){t.add({title:"media.edit",icon:"media",cmd:"mceMedia"})}})}});n.addCommand("mceMedia",function(){var s,i;i=n.selection.getNode();if(j(i)){s=g.parse(n.dom.getAttrib(i,"data-mce-json"));tinymce.each(d,function(t){var u=n.dom.getAttrib(i,t);if(u){s[t]=u}});s.type=q.getType(i.className).name.toLowerCase()}if(!s){s={type:"flash",video:{sources:[]},params:{}}}n.windowManager.open({file:l+"/media.htm",width:430+parseInt(n.getLang("media.delta_width",0)),height:500+parseInt(n.getLang("media.delta_height",0)),inline:1},{plugin_url:l,data:s})});n.addButton("media",{title:"media.desc",cmd:"mceMedia"});n.onNodeChange.add(function(s,i,t){i.setActive("media",j(t))})},convertUrl:function(k,n){var j=this,i=j.editor,l=i.settings,o=l.url_converter,m=l.url_converter_scope||j;if(!k){return k}if(n){return i.documentBaseURI.toAbsolute(k)}return o.call(m,k,"src","object")},getInfo:function(){return{longname:"Media",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/media",version:tinymce.majorVersion+"."+tinymce.minorVersion}},dataToImg:function(n,k){var q=this,j=q.editor,r=j.documentBaseURI,o,p,m,l;n.params.src=q.convertUrl(n.params.src,k);p=n.video.attrs;if(p){p.src=q.convertUrl(p.src,k)}if(p){p.poster=q.convertUrl(p.poster,k)}o=b(n.video.sources);if(o){for(l=0;l<o.length;l++){o[l].src=q.convertUrl(o[l].src,k)}}m=q.editor.dom.create("img",{id:n.id,style:n.style,align:n.align,src:q.editor.theme.url+"/img/trans.gif","class":"mceItemMedia mceItem"+q.getType(n.type).name,"data-mce-json":g.serialize(n,"'")});m.width=n.width||"320";m.height=n.height||"240";return m},dataToHtml:function(i,j){return this.editor.serializer.serialize(this.dataToImg(i,j),{force_absolute:j})},htmlToData:function(k){var j,i,l;l={type:"flash",video:{sources:[]},params:{}};j=this.editor.parser.parse(k);i=j.getAll("img")[0];if(i){l=g.parse(i.attr("data-mce-json"));l.type=this.getType(i.attr("class")).name.toLowerCase();tinymce.each(d,function(m){var n=i.attr(m);if(n){l[m]=n}})}return l},getType:function(m){var k,l,j;l=tinymce.explode(m," ");for(k=0;k<l.length;k++){j=this.lookup[l[k]];if(j){return j}}},imgToObject:function(x,l){var u=this,q=u.editor,B,t,j,m,F,y,E,D,s,v,p,o,z,C,r,w,k,A;function n(i,G){var K,J,L,I,H;H=q.getParam("flash_video_player_url",u.convertUrl(u.url+"/moxieplayer.swf"));if(H){K=q.documentBaseURI;E.params.src=H;if(q.getParam("flash_video_player_absvideourl",true)){i=K.toAbsolute(i||"",true);G=K.toAbsolute(G||"",true)}L="";J=q.getParam("flash_video_player_flashvars",{url:"$url",poster:"$poster"});tinymce.each(J,function(N,M){N=N.replace(/\$url/,i||"");N=N.replace(/\$poster/,G||"");if(N.length>0){L+=(L?"&":"")+M+"="+escape(N)}});if(L.length){E.params.flashvars=L}I=q.getParam("flash_video_player_params",{allowfullscreen:true,allowscriptaccess:true});tinymce.each(I,function(N,M){E.params[M]=""+N})}}E=g.parse(x.attr("data-mce-json"));o=this.getType(x.attr("class"));A=x.attr("data-mce-style");if(!A){A=x.attr("style");if(A){A=q.dom.serializeStyle(q.dom.parseStyle(A,"img"))}}if(o.name==="Iframe"){w=new c("iframe",1);tinymce.each(d,function(i){var G=x.attr(i);if(i=="class"&&G){G=G.replace(/mceItem.+ ?/g,"")}if(G&&G.length>0){w.attr(i,G)}});for(F in E.params){w.attr(F,E.params[F])}w.attr({style:A,src:E.params.src});x.replace(w);return}if(this.editor.settings.media_use_script){w=new c("script",1).attr("type","text/javascript");y=new c("#text",3);y.value="write"+o.name+"("+g.serialize(tinymce.extend(E.params,{width:x.attr("width"),height:x.attr("height")}))+");";w.append(y);x.replace(w);return}if(o.name==="Video"&&E.video.sources[0]){B=new c("video",1).attr(tinymce.extend({id:x.attr("id"),width:x.attr("width"),height:x.attr("height"),style:A},E.video.attrs));if(E.video.attrs){k=E.video.attrs.poster}s=E.video.sources=b(E.video.sources);for(z=0;z<s.length;z++){if(/\.mp4$/.test(s[z].src)){r=s[z].src}}if(!s[0].type){B.attr("src",s[0].src);s.splice(0,1)}for(z=0;z<s.length;z++){D=new c("source",1).attr(s[z]);D.shortEnded=true;B.append(D)}if(r){n(r,k);o=u.getType("flash")}else{E.params.src=""}}if(E.params.src){if(/\.flv$/i.test(E.params.src)){n(E.params.src,"")}if(l&&l.force_absolute){E.params.src=q.documentBaseURI.toAbsolute(E.params.src)}t=new c("object",1).attr({id:x.attr("id"),width:x.attr("width"),height:x.attr("height"),style:A});tinymce.each(d,function(i){if(E[i]&&i!="type"){t.attr(i,E[i])}});for(F in E.params){p=new c("param",1);p.shortEnded=true;y=E.params[F];if(F==="src"&&o.name==="WindowsMedia"){F="url"}p.attr({name:F,value:y});t.append(p)}if(this.editor.getParam("media_strict",true)){t.attr({data:E.params.src,type:o.mimes[0]})}else{t.attr({classid:"clsid:"+o.clsids[0],codebase:o.codebase});j=new c("embed",1);j.shortEnded=true;j.attr({id:x.attr("id"),width:x.attr("width"),height:x.attr("height"),style:A,type:o.mimes[0]});for(F in E.params){j.attr(F,E.params[F])}tinymce.each(d,function(i){if(E[i]&&i!="type"){j.attr(i,E[i])}});t.append(j)}if(E.object_html){y=new c("#text",3);y.raw=true;y.value=E.object_html;t.append(y)}if(B){B.append(t)}}if(B){if(E.video_html){y=new c("#text",3);y.raw=true;y.value=E.video_html;B.append(y)}}if(B||t){x.replace(B||t)}else{x.remove()}},objectToImg:function(y){var s,j,B,l,H,G,t,w,D,A,z,p,n,x,C,q,E,m,v=this.lookup,k,u,r=this.editor.settings.url_converter,o=this.editor.settings.url_converter_scope;function F(i){return new tinymce.html.Serializer({inner:true,validate:false}).serialize(i)}if(!y.parent){return}if(y.name==="script"){if(y.firstChild){k=e.exec(y.firstChild.value)}if(!k){return}m=k[1];E={video:{},params:g.parse(k[2])};w=E.params.width;D=E.params.height}E=E||{video:{},params:{}};H=new c("img",1);H.attr({src:this.editor.theme.url+"/img/trans.gif"});G=y.name;if(G==="video"){B=y;s=y.getAll("object")[0];j=y.getAll("embed")[0];w=B.attr("width");D=B.attr("height");t=B.attr("id");E.video={attrs:{},sources:[]};u=E.video.attrs;for(G in B.attributes.map){u[G]=B.attributes.map[G]}C=y.attr("src");if(C){E.video.sources.push({src:r.call(o,C,"src","video")})}q=B.getAll("source");for(z=0;z<q.length;z++){C=q[z].remove();E.video.sources.push({src:r.call(o,C.attr("src"),"src","source"),type:C.attr("type"),media:C.attr("media")})}if(u.poster){u.poster=r.call(o,u.poster,"poster","video")}}if(y.name==="object"){s=y;j=y.getAll("embed")[0]}if(y.name==="embed"){j=y}if(y.name==="iframe"){l=y;m="Iframe"}if(s){w=w||s.attr("width");D=D||s.attr("height");A=A||s.attr("style");t=t||s.attr("id");x=s.getAll("param");for(z=0;z<x.length;z++){n=x[z];G=n.remove().attr("name");if(!h[G]){E.params[G]=n.attr("value")}}E.params.src=E.params.src||s.attr("data")}if(j){w=w||j.attr("width");D=D||j.attr("height");A=A||j.attr("style");t=t||j.attr("id");for(G in j.attributes.map){if(!h[G]&&!E.params[G]){E.params[G]=j.attributes.map[G]}}}if(l){w=l.attr("width");D=l.attr("height");A=A||l.attr("style");t=l.attr("id");tinymce.each(d,function(i){H.attr(i,l.attr(i))});for(G in l.attributes.map){if(!h[G]&&!E.params[G]){E.params[G]=l.attributes.map[G]}}}if(E.params.movie){E.params.src=E.params.src||E.params.movie;delete E.params.movie}if(E.params.src){E.params.src=r.call(o,E.params.src,"src","object")}if(B){m=v.video.name}if(s&&!m){m=(v[(s.attr("clsid")||"").toLowerCase()]||v[(s.attr("type")||"").toLowerCase()]||{}).name}if(j&&!m){m=(v[(j.attr("type")||"").toLowerCase()]||{}).name}y.replace(H);if(j){j.remove()}if(s){p=F(s.remove());if(p){E.object_html=p}}if(B){p=F(B.remove());if(p){E.video_html=p}}H.attr({id:t,"class":"mceItemMedia mceItem"+(m||"Flash"),style:A,width:w||"320",height:D||"240","data-mce-json":g.serialize(E,"'")})}});tinymce.PluginManager.add("media",tinymce.plugins.MediaPlugin)})();