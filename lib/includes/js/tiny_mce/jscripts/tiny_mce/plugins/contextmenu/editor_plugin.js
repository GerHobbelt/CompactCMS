(function(){var a=tinymce.dom.Event,c=tinymce.each,b=tinymce.DOM;tinymce.create("tinymce.plugins.ContextMenu",{init:function(d){var g=this,i,f,h;g.editor=d;h=d.settings.contextmenu_never_use_native;g.onContextMenu=new tinymce.util.Dispatcher(this);f=d.onContextMenu.add(function(j,k){if(k.ctrlKey&&!h){return}if(i){j.selection.setRng(i)}g._getMenu(j).showMenu(k.clientX||k.pageX,k.clientY||k.pageX);a.add(j.getDoc(),"click",function(l){e(j,l)});a.cancel(k)});d.onRemove.add(function(){if(g._menu){g._menu.removeAll()}});function e(j,k){i=null;if(k&&k.button==2){i=j.selection.getRng();return}if(g._menu){g._menu.removeAll();g._menu.destroy();a.remove(j.getDoc(),"click",e)}}d.onMouseDown.add(e);d.onKeyDown.add(e);d.onKeyDown.add(function(j,k){if(k.shiftKey&&!k.ctrlKey&&!k.altKey&&k.keyCode===121){a.cancel(k);f(j,k)}})},getInfo:function(){return{longname:"Contextmenu",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/contextmenu",version:tinymce.majorVersion+"."+tinymce.minorVersion}},_getMenu:function(g){var l=this,f=l._menu,i=g.selection,e=i.isCollapsed(),d=i.getNode()||g.getBody(),h,k,j;if(f){f.removeAll();f.destroy()}k=b.getPos(g.getContentAreaContainer());j=b.getPos(g.getContainer());f=g.controlManager.createDropMenu("contextmenu",{offset_x:k.x+g.getParam("contextmenu_offset_x",0),offset_y:k.y+g.getParam("contextmenu_offset_y",0),constrain:1,keyboard_focus:true});l._menu=f;f.add({title:"advanced.cut_desc",icon:"cut",cmd:"Cut"}).setDisabled(e);f.add({title:"advanced.copy_desc",icon:"copy",cmd:"Copy"}).setDisabled(e);f.add({title:"advanced.paste_desc",icon:"paste",cmd:"Paste"});if((d.nodeName=="A"&&!g.dom.getAttrib(d,"name"))||!e){f.addSeparator();f.add({title:"advanced.link_desc",icon:"link",cmd:g.plugins.advlink?"mceAdvLink":"mceLink",ui:true});f.add({title:"advanced.unlink_desc",icon:"unlink",cmd:"UnLink"})}f.addSeparator();f.add({title:"advanced.image_desc",icon:"image",cmd:g.plugins.advimage?"mceAdvImage":"mceImage",ui:true});f.addSeparator();h=f.addMenu({title:"contextmenu.align"});h.add({title:"contextmenu.left",icon:"justifyleft",cmd:"JustifyLeft"});h.add({title:"contextmenu.center",icon:"justifycenter",cmd:"JustifyCenter"});h.add({title:"contextmenu.right",icon:"justifyright",cmd:"JustifyRight"});h.add({title:"contextmenu.full",icon:"justifyfull",cmd:"JustifyFull"});l.onContextMenu.dispatch(l,f,d,e);return f}});tinymce.PluginManager.add("contextmenu",tinymce.plugins.ContextMenu)})();