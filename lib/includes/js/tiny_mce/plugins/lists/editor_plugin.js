(function(){var f=tinymce.each,r=tinymce.dom.Event,h;function l(t,s){while(t&&(t.nodeType===8||(t.nodeType===3&&/^[ \t\n\r]*$/.test(t.nodeValue)))){t=s(t)}return t}function j(s){return l(s,function(t){return t.previousSibling})}function i(s){return l(s,function(t){return t.nextSibling})}function e(s,u,t){return s.dom.getParent(u,function(v){return tinymce.inArray(t,v)!==-1})}function n(s){return s&&(s.tagName==="OL"||s.tagName==="UL")}function d(s,w){var t,v,u;t=j(s.lastChild);while(n(t)){v=t;t=j(v.previousSibling)}if(v){u=w.create("li",{style:"list-style-type: none;"});w.split(s,v);w.insertAfter(u,v);u.appendChild(v);u.appendChild(v);s=u.previousSibling}return s}function o(u,s,t){u=b(u,s,t);return q(u,s,t)}function b(v,s,u){var t=j(v.previousSibling);if(t){return c(t,v,s?t:false,u)}else{return v}}function q(v,t,u){var s=i(v.nextSibling);if(s){return c(v,s,t?s:false,u)}else{return v}}function c(v,t,u,s){if(p(v,t,!!u,s)){return g(v,t,u)}else{if(v&&v.tagName==="LI"&&n(t)){v.appendChild(t)}}return t}function p(v,u,s,t){if(!v||!u){return false}else{if(v.tagName==="LI"&&u.tagName==="LI"){return u.style.listStyleType==="none"||a(u)}else{if(n(v)){return(v.tagName===u.tagName&&(s||v.style.listStyleType===u.style.listStyleType))||k(u)}else{if(t&&v.tagName==="P"&&u.tagName==="P"){return true}else{return false}}}}}function k(t){var s=i(t.firstChild),u=j(t.lastChild);return s&&u&&n(t)&&s===u&&(n(s)||s.style.listStyleType==="none"||a(s))}function a(t){var u=i(t.firstChild),s=j(t.lastChild);return u&&s&&u===s&&n(u)}function g(w,v,u){var s=j(w.lastChild),t=i(v.firstChild);if(w.tagName==="P"){w.appendChild(w.ownerDocument.createElement("br"))}while(v.firstChild){w.appendChild(v.firstChild)}if(u){w.style.listStyleType=u.style.listStyleType}v.parentNode.removeChild(v);c(s,t,false);return w}function m(t,u){var s;if(!u.is(t,"li,ol,ul")){s=u.getParent(t,"li");if(s){t=s}}return t}tinymce.create("tinymce.ephox.plugins.Lists",{init:function(t,u){var w=false;function x(y){return y.keyCode===9&&(t.queryCommandState("InsertUnorderedList")||t.queryCommandState("InsertOrderedList"))}function v(y,A){var z=y.selection,B;if(A.keyCode===13){B=z.getStart();w=z.isCollapsed()&&B&&B.tagName==="LI"&&B.childNodes.length===0;return w}}function s(y,z){if(x(z)||v(y,z)){return r.cancel(z)}}this.ed=t;t.addCommand("Indent",this.indent,this);t.addCommand("Outdent",this.outdent,this);t.addCommand("InsertUnorderedList",function(){this.applyList("UL","OL")},this);t.addCommand("InsertOrderedList",function(){this.applyList("OL","UL")},this);t.onInit.add(function(){t.editorCommands.addCommands({outdent:function(){var z=t.selection,A=t.dom;function y(B){B=A.getParent(B,A.isBlock);return B&&(parseInt(t.dom.getStyle(B,"margin-left")||0,10)+parseInt(t.dom.getStyle(B,"padding-left")||0,10))>0}return y(z.getStart())||y(z.getEnd())||t.queryCommandState("InsertOrderedList")||t.queryCommandState("InsertUnorderedList")}},"state")});t.onKeyUp.add(function(z,A){var B,y;if(x(A)){z.execCommand(A.shiftKey?"Outdent":"Indent",true,null);return r.cancel(A)}else{if(w&&v(z,A)){if(z.queryCommandState("InsertOrderedList")){z.execCommand("InsertOrderedList")}else{z.execCommand("InsertUnorderedList")}B=z.selection.getStart();if(B&&B.tagName==="LI"){B=z.dom.getParent(B,"ol,ul").nextSibling;if(B&&B.tagName==="P"){if(!B.firstChild){B.appendChild(z.getDoc().createTextNode(""))}y=z.dom.createRng();y.setStart(B.firstChild,1);y.setEnd(B.firstChild,1);z.selection.setRng(y)}}return r.cancel(A)}}});t.onKeyPress.add(s);t.onKeyDown.add(s)},applyList:function(z,u){var C=this,y=C.ed,F=y.dom,B=[],G=false,v=false,A=false,s,E=y.selection.getSelectedBlocks();function H(t){if(t&&t.tagName==="BR"){F.remove(t)}}function D(M){var N=F.create(z),t;function L(O){if(O.style.marginLeft||O.style.paddingLeft){C.adjustPaddingFunction(false)(O)}}if(M.tagName==="LI"){}else{if(M.tagName==="P"||M.tagName==="DIV"||M.tagName==="BODY"){K(M,function(Q,O,P){I(Q,O,M.tagName==="BODY"?null:Q.parentNode);t=Q.parentNode;L(t);H(O)});if(M.tagName==="P"||E.length>1){F.split(t.parentNode.parentNode,t.parentNode)}o(t.parentNode,true);return}else{t=F.create("li");F.insertAfter(t,M);t.appendChild(M);L(M);M=t}}F.insertAfter(N,M);N.appendChild(M);o(N,true);B.push(M)}function I(Q,L,M){var t,P=Q,O,N;if(M){t=M.cloneNode(true);Q.parentNode.insertBefore(t,Q);while(t.firstChild){F.remove(t.firstChild)}t=F.rename(t,"li")}else{t=F.create("li");Q.parentNode.insertBefore(t,Q)}while(P!=L){O=P.nextSibling;t.appendChild(P);P=O}if(t.childNodes.length===0){t.innerHTML='<br _mce_bogus="1" />'}D(t)}function K(O,S){var N,L,Q=3,M=1,t="br,ul,ol,p,div,h1,h2,h3,h4,h5,h6,table,blockquote,address,pre,form,center,dl";function P(W,T){var U=F.createRng(),V;h.keep=true;y.selection.moveToBookmark(h);h.keep=false;V=y.selection.getRng(true);if(!T){T=W.parentNode.lastChild}U.setStartBefore(W);U.setEndAfter(T);return !(U.compareBoundaryPoints(Q,V)>0||U.compareBoundaryPoints(M,V)<=0)}N=O.firstChild;var R=false;f(F.select(t,O),function(U){var T;if(U.hasAttribute&&U.hasAttribute("_mce_bogus")){return true}if(P(N,U)){F.addClass(U,"_mce_tagged_br");N=U.nextSibling}});R=(N&&P(N,undefined));N=O.firstChild;f(F.select(t,O),function(U){var T=U.nextSibling;if(U.hasAttribute&&U.hasAttribute("_mce_bogus")){return true}if(F.hasClass(U,"_mce_tagged_br")){S(N,U,L);L=null}else{L=U}N=T});if(R){S(N,undefined,L)}}function J(t){K(t,function(N,L,M){I(N,L);H(L);H(M)})}function w(t){if(tinymce.inArray(B,t)!==-1){return}if(t.parentNode.tagName===u){F.split(t.parentNode,t);D(t);q(t.parentNode,false)}B.push(t)}function x(M){var O,N,L,t;if(tinymce.inArray(B,M)!==-1){return}M=d(M,F);while(F.is(M.parentNode,"ol,ul,li")){F.split(M.parentNode,M)}B.push(M);M=F.rename(M,"p");L=o(M,false,y.settings.force_br_newlines);if(L===M){O=M.firstChild;while(O){if(F.isBlock(O)){O=F.split(O.parentNode,O);t=true;N=O.nextSibling&&O.nextSibling.firstChild}else{N=O.nextSibling;if(t&&O.tagName==="BR"){F.remove(O)}t=false}O=N}}}f(E,function(t){t=m(t,F);if(t.tagName===u||(t.tagName==="LI"&&t.parentNode.tagName===u)){v=true}else{if(t.tagName===z||(t.tagName==="LI"&&t.parentNode.tagName===z)){G=true}else{A=true}}});if(A||v||E.length===0){s={LI:w,H1:D,H2:D,H3:D,H4:D,H5:D,H6:D,P:D,BODY:D,DIV:E.length>1?D:J,defaultAction:J}}else{s={defaultAction:x}}this.process(s)},indent:function(){var s=this.ed,w=s.dom,x=[];function u(y){var z=w.create("li",{style:"list-style-type: none;"});w.insertAfter(z,y);return z}function t(z){var D=u(z),C=w.getParent(z,"ol,ul"),A=C.tagName,E=w.getStyle(C,"list-style-type"),y={},B;if(E!==""){y.style="list-style-type: "+E+";"}B=w.create(A,y);D.appendChild(B);return B}function v(y){if(!e(s,y,x)){y=d(y,w);var z=t(y);z.appendChild(y);o(z.parentNode,false);o(z,false);x.push(y)}}this.process({LI:v,defaultAction:this.adjustPaddingFunction(true)})},outdent:function(){var v=this,u=v.ed,w=u.dom,s=[];function x(z){var y,t,A;if(!e(u,z,s)){if(w.getStyle(z,"margin-left")!==""||w.getStyle(z,"padding-left")!==""){return v.adjustPaddingFunction(false)(z)}A=w.getStyle(z,"text-align",true);if(A==="center"||A==="right"){w.setStyle(z,"text-align","left");return}z=d(z,w);y=z.parentNode;t=z.parentNode.parentNode;if(t.tagName==="P"){w.split(t,z.parentNode)}else{w.split(y,z);if(t.tagName==="LI"){w.split(t,z)}else{if(!w.is(t,"ol,ul")){w.rename(z,"p")}}}s.push(z)}}this.process({LI:x,defaultAction:this.adjustPaddingFunction(false)});f(s,o)},process:function(w){var B=this,v=B.ed.selection,x=B.ed.dom,z,s;function y(C){x.removeClass(C,"_mce_act_on");if(!C||C.nodeType!==1){return}C=m(C,x);var t=w[C.tagName];if(!t){t=w.defaultAction}t(C)}function u(t){B.splitSafeEach(t.childNodes,y)}function A(t,C,D){return C>=0&&t.hasChildNodes()&&t.childNodes[C].tagName==="BR"}z=v.getSelectedBlocks();if(z.length===0){z=[x.getRoot()]}s=v.getRng(true);if(!s.collapsed){if(A(s.endContainer,s.endOffset-1)){s.setEnd(s.endContainer,s.endOffset-1);v.setRng(s)}if(A(s.startContainer,s.startOffset)){s.setStart(s.startContainer,s.startOffset+1);v.setRng(s)}}h=v.getBookmark();w.OL=w.UL=u;B.splitSafeEach(z,y);v.moveToBookmark(h);h=null;B.ed.execCommand("mceRepaint")},splitSafeEach:function(s,t){if(tinymce.isGecko&&(/Firefox\/[12]\.[0-9]/.test(navigator.userAgent)||/Firefox\/3\.[0-4]/.test(navigator.userAgent))){this.classBasedEach(s,t)}else{f(s,t)}},classBasedEach:function(s,v){var w=this.ed.dom,t,u;f(s,function(x){w.addClass(x,"_mce_act_on")});t=w.select("._mce_act_on");while(t.length>0){u=t.shift();w.removeClass(u,"_mce_act_on");v(u);t=w.select("._mce_act_on")}},adjustPaddingFunction:function(v){var s,u,t=this.ed;s=t.settings.indentation;u=/[a-z%]+/i.exec(s);s=parseInt(s,10);return function(x){var y,w;y=parseInt(t.dom.getStyle(x,"margin-left")||0,10)+parseInt(t.dom.getStyle(x,"padding-left")||0,10);if(v){w=y+s}else{w=y-s}t.dom.setStyle(x,"padding-left","");t.dom.setStyle(x,"margin-left",w>0?w+u:"")}},getInfo:function(){return{longname:"Lists",author:"Ephox Corporation",authorurl:"http://tinymce.ephox.com",infourl:"http://tinymce.ephox.com",version:tinymce.majorVersion+"."+tinymce.minorVersion}}});tinymce.PluginManager.add("lists",tinymce.ephox.plugins.Lists)}());