(function(a){var d=a.each;function c(f,g){var h=g.ownerDocument,e=h.createRange(),j;e.setStartBefore(g);e.setEnd(f.endContainer,f.endOffset);j=h.createElement("body");j.appendChild(e.cloneContents());return j.innerHTML.replace(/<(br|img|object|embed|input|textarea)[^>]*>/gi,"-").replace(/<[^>]+>/g,"").length==0}function b(G,E,v){var e,L,F,m;g();m=E.getParent(v.getStart(),"th,td");if(m){L=D(m);F=A();m=K(L.x,L.y)}function J(N,M){N=N.cloneNode(M);N.removeAttribute("id");return N}function g(){var M=0;e=[];d(["thead","tbody","tfoot"],function(N){var O=E.select("> "+N+" tr",G);d(O,function(P,Q){Q+=M;d(E.select("> td, > th",P),function(W,R){var S,T,U,V;if(e[Q]){while(e[Q][R]){R++}}U=r(W,"rowspan");V=r(W,"colspan");for(T=Q;T<Q+U;T++){if(!e[T]){e[T]=[]}for(S=R;S<R+V;S++){e[T][S]={part:N,real:T==Q&&S==R,elm:W,rowspan:U,colspan:V}}}})});M+=O.length})}function K(M,O){var N;N=e[O];if(N){return N[M]}}function r(N,M){return parseInt(N.getAttribute(M)||1)}function p(O,M,N){if(O){N=parseInt(N);if(N===1){O.removeAttribute(M,1)}else{O.setAttribute(M,N,1)}}}function f(M){return E.hasClass(M.elm,"mceSelected")||M==m}function q(){var M=[];d(G.rows,function(N){d(N.cells,function(O){if(E.hasClass(O,"mceSelected")||O==m.elm){M.push(N);return false}})});return M}function h(){var M=E.createRng();M.setStartAfter(G);M.setEndAfter(G);v.setRng(M);E.remove(G)}function u(M){var N;a.walk(M,function(P){var O;if(P.nodeType==3){d(E.getParents(P.parentNode,null,M).reverse(),function(Q){Q=J(Q,false);if(!N){N=O=Q}else{if(O){O.appendChild(Q)}}O=Q});if(O){O.innerHTML=a.isIE?"&nbsp;":'<br data-mce-bogus="1" />'}return false}},"childNodes");M=J(M,false);p(M,"rowspan",1);p(M,"colspan",1);if(N){M.appendChild(N)}else{if(!a.isIE){M.innerHTML='<br data-mce-bogus="1" />'}}return M}function n(){var M=E.createRng();d(E.select("tr",G),function(N){if(N.cells.length==0){E.remove(N)}});if(E.select("tr",G).length==0){M.setStartAfter(G);M.setEndAfter(G);v.setRng(M);E.remove(G);return}d(E.select("thead,tbody,tfoot",G),function(N){if(N.rows.length==0){E.remove(N)}});g();row=e[Math.min(e.length-1,L.y)];if(row){v.select(row[Math.min(row.length-1,L.x)].elm,true);v.collapse(true)}}function t(S,R,U,Q){var O,N,M,P,T;O=e[R][S].elm.parentNode;for(M=1;M<=U;M++){O=E.getNext(O,"tr");if(O){for(N=S;N>=0;N--){T=e[R+M][N].elm;if(T.parentNode==O){for(P=1;P<=Q;P++){E.insertAfter(u(T),T)}break}}if(N==-1){for(P=1;P<=Q;P++){O.insertBefore(u(O.cells[0]),O.cells[0])}}}}}function z(){d(e,function(M,N){d(M,function(P,O){var S,R,T,Q;if(f(P)){P=P.elm;S=r(P,"colspan");R=r(P,"rowspan");if(S>1||R>1){p(P,"rowspan",1);p(P,"colspan",1);for(Q=0;Q<S-1;Q++){E.insertAfter(u(P),P)}t(O,N,R-1,S)}}})})}function l(U,S,Y){var N,O,X,V,T,R,W,Q,U,M,P;if(U){pos=D(U);N=pos.x;O=pos.y;X=N+(S-1);V=O+(Y-1)}else{N=L.x;O=L.y;X=F.x;V=F.y}W=K(N,O);Q=K(X,V);if(W&&Q&&W.part==Q.part){z();g();W=K(N,O).elm;p(W,"colspan",(X-N)+1);p(W,"rowspan",(V-O)+1);for(R=O;R<=V;R++){for(T=N;T<=X;T++){U=e[R][T].elm;if(U!=W){M=a.grep(U.childNodes);d(M,function(Z){W.appendChild(Z)});if(M.length){M=a.grep(W.childNodes);P=0;d(M,function(Z){if(Z.nodeName=="BR"&&E.getAttrib(Z,"data-mce-bogus")&&P++<M.length-1){W.removeChild(Z)}})}E.remove(U)}}}n()}}function o(U){var N,T,M,Q,R,S,O,P;d(e,function(V,W){d(V,function(Y,X){if(f(Y)){Y=Y.elm;R=Y.parentNode;S=J(R,false);N=W;if(U){return false}}});if(U){return !N}});for(Q=0;Q<e[0].length;Q++){T=e[N][Q].elm;if(T!=M){if(!U){rowSpan=r(T,"rowspan");if(rowSpan>1){p(T,"rowspan",rowSpan+1);continue}}else{if(N>0&&e[N-1][Q]){P=e[N-1][Q].elm;rowSpan=r(P,"rowspan");if(rowSpan>1){p(P,"rowspan",rowSpan+1);continue}}}O=u(T);p(O,"colspan",T.colSpan);S.appendChild(O);M=T}}if(S.hasChildNodes()){if(!U){E.insertAfter(S,R)}else{R.parentNode.insertBefore(S,R)}}}function s(M){var O,N;d(e,function(P,Q){d(P,function(S,R){if(f(S)){O=R;if(M){return false}}});if(M){return !O}});d(e,function(S,T){var P=S[O].elm,Q,R;if(P!=N){R=r(P,"colspan");Q=r(P,"rowspan");if(R==1){if(!M){E.insertAfter(u(P),P);t(O,T,Q-1,R)}else{P.parentNode.insertBefore(u(P),P);t(O,T,Q-1,R)}}else{p(P,"colspan",P.colSpan+1)}N=P}})}function k(){var M=[];d(e,function(N,O){d(N,function(Q,P){if(f(Q)&&a.inArray(M,P)===-1){d(e,function(T){var R=T[P].elm,S;S=r(R,"colspan");if(S>1){p(R,"colspan",S-1)}else{E.remove(R)}});M.push(P)}})});n()}function j(){var N;function M(Q){var O,R,P;O=E.getNext(Q,"tr");d(Q.cells,function(S){var T=r(S,"rowspan");if(T>1){p(S,"rowspan",T-1);R=D(S);t(R.x,R.y,1,1)}});R=D(Q.cells[0]);d(e[R.y],function(S){var T;S=S.elm;if(S!=P){T=r(S,"rowspan");if(T<=1){E.remove(S)}else{p(S,"rowspan",T-1)}P=S}})}N=q();d(N.reverse(),function(O){M(O)});n()}function C(){var M=q();E.remove(M);n();return M}function B(){var M=q();d(M,function(O,N){M[N]=J(O,true)});return M}function H(O,M){var Q=q(),N=Q[M?0:Q.length-1],P=N.cells.length;d(e,function(S){var R;P=0;d(S,function(U,T){if(U.real){P+=U.colspan}if(U.elm.parentNode==N){R=1}});if(R){return false}});if(!M){O.reverse()}d(O,function(T){var S=T.cells.length,R;for(i=0;i<S;i++){R=T.cells[i];p(R,"colspan",1);p(R,"rowspan",1)}for(i=S;i<P;i++){T.appendChild(u(T.cells[S-1]))}for(i=P;i<S;i++){E.remove(T.cells[i])}if(M){N.parentNode.insertBefore(T,N)}else{E.insertAfter(T,N)}})}function D(N){var M;d(e,function(O,P){d(O,function(R,Q){if(R.elm==N){M={x:Q,y:P};return false}});return !M});return M}function I(M){L=D(M)}function A(){var O,N,M;N=M=0;d(e,function(P,Q){d(P,function(S,R){var U,T;if(f(S)){S=e[Q][R];if(R>N){N=R}if(Q>M){M=Q}if(S.real){U=S.colspan-1;T=S.rowspan-1;if(U){if(R+U>N){N=R+U}}if(T){if(Q+T>M){M=Q+T}}}}})});return{x:N,y:M}}function w(S){var O,P,U,T,N,M,Q,R;F=D(S);if(L&&F){O=Math.min(L.x,F.x);P=Math.min(L.y,F.y);U=Math.max(L.x,F.x);T=Math.max(L.y,F.y);N=U;M=T;for(y=P;y<=M;y++){S=e[y][O];if(!S.real){if(O-(S.colspan-1)<O){O-=S.colspan-1}}}for(x=O;x<=N;x++){S=e[P][x];if(!S.real){if(P-(S.rowspan-1)<P){P-=S.rowspan-1}}}for(y=P;y<=T;y++){for(x=O;x<=U;x++){S=e[y][x];if(S.real){Q=S.colspan-1;R=S.rowspan-1;if(Q){if(x+Q>N){N=x+Q}}if(R){if(y+R>M){M=y+R}}}}}E.removeClass(E.select("td.mceSelected,th.mceSelected"),"mceSelected");for(y=P;y<=M;y++){for(x=O;x<=N;x++){E.addClass(e[y][x].elm,"mceSelected")}}}}a.extend(this,{deleteTable:h,split:z,merge:l,insertRow:o,insertCol:s,deleteCols:k,deleteRows:j,cutRows:C,copyRows:B,pasteRows:H,getPos:D,setStartCell:I,setEndCell:w})}a.create("tinymce.plugins.TablePlugin",{init:function(e,f){var h,k;function j(n){var l=e.selection,m=e.dom.getParent(n||l.getNode(),"table");if(m){return new b(m,e.dom,l)}}function g(){e.getBody().style.webkitUserSelect="";e.dom.removeClass(e.dom.select("td.mceSelected,th.mceSelected"),"mceSelected")}d([["table","table.desc","mceInsertTable",true],["delete_table","table.del","mceTableDelete"],["delete_col","table.delete_col_desc","mceTableDeleteCol"],["delete_row","table.delete_row_desc","mceTableDeleteRow"],["col_after","table.col_after_desc","mceTableInsertColAfter"],["col_before","table.col_before_desc","mceTableInsertColBefore"],["row_after","table.row_after_desc","mceTableInsertRowAfter"],["row_before","table.row_before_desc","mceTableInsertRowBefore"],["row_props","table.row_desc","mceTableRowProps",true],["cell_props","table.cell_desc","mceTableCellProps",true],["split_cells","table.split_cells_desc","mceTableSplitCells",true],["merge_cells","table.merge_cells_desc","mceTableMergeCells",true]],function(l){e.addButton(l[0],{title:l[1],cmd:l[2],ui:l[3]})});if(!a.isIE){e.onClick.add(function(l,m){m=m.target;if(m.nodeName==="TABLE"){l.selection.select(m)}})}e.onNodeChange.add(function(m,l,q){var o;q=m.selection.getStart();o=m.dom.getParent(q,"td,th,caption");l.setActive("table",q.nodeName==="TABLE"||!!o);if(o&&o.nodeName==="CAPTION"){o=0}l.setDisabled("delete_table",!o);l.setDisabled("delete_col",!o);l.setDisabled("delete_table",!o);l.setDisabled("delete_row",!o);l.setDisabled("col_after",!o);l.setDisabled("col_before",!o);l.setDisabled("row_after",!o);l.setDisabled("row_before",!o);l.setDisabled("row_props",!o);l.setDisabled("cell_props",!o);l.setDisabled("split_cells",!o);l.setDisabled("merge_cells",!o)});e.onInit.add(function(l){var o,q,p=l.dom,n;h=l.windowManager;l.onMouseDown.add(function(r,s){if(s.button!=2){g();q=p.getParent(s.target,"td,th");o=p.getParent(q,"table")}});p.bind(l.getDoc(),"mouseover",function(t){var s,r,u=t.target;if(q&&(n||u!=q)&&(u.nodeName=="TD"||u.nodeName=="TH")){r=p.getParent(u,"table");if(r==o){if(!n){n=j(r);n.setStartCell(q);l.getBody().style.webkitUserSelect="none"}n.setEndCell(u)}s=l.selection.getSel();if(s.removeAllRanges){s.removeAllRanges()}else{s.empty()}t.preventDefault()}});l.onMouseUp.add(function(w,z){var r,s=w.selection,B,D=s.getSel(),C,u,A,t;if(q){if(n){w.getBody().style.webkitUserSelect=""}function v(E,G){var F=new a.dom.TreeWalker(E,E);do{if(E.nodeType==3&&a.trim(E.nodeValue).length!=0){if(G){r.setStart(E,0)}else{r.setEnd(E,E.nodeValue.length)}return}if(E.nodeName=="BR"){if(G){r.setStartBefore(E)}else{r.setEndBefore(E)}return}}while(E=(G?F.next():F.prev()))}B=p.select("td.mceSelected,th.mceSelected");if(B.length>0){r=p.createRng();u=B[0];t=B[B.length-1];v(u,1);C=new a.dom.TreeWalker(u,p.getParent(B[0],"table"));do{if(u.nodeName=="TD"||u.nodeName=="TH"){if(!p.hasClass(u,"mceSelected")){break}A=u}}while(u=C.next());v(A);s.setRng(r)}w.nodeChanged();q=n=o=null}});l.onKeyUp.add(function(r,s){g()});if(l&&l.plugins.contextmenu){l.plugins.contextmenu.onContextMenu.add(function(t,r,v){var w,u=l.selection,s=u.getNode()||l.getBody();if(l.dom.getParent(v,"td")||l.dom.getParent(v,"th")||l.dom.select("td.mceSelected,th.mceSelected").length){r.removeAll();if(s.nodeName=="A"&&!l.dom.getAttrib(s,"name")){r.add({title:"advanced.link_desc",icon:"link",cmd:l.plugins.advlink?"mceAdvLink":"mceLink",ui:true});r.add({title:"advanced.unlink_desc",icon:"unlink",cmd:"UnLink"});r.addSeparator()}if(s.nodeName=="IMG"&&s.className.indexOf("mceItem")==-1){r.add({title:"advanced.image_desc",icon:"image",cmd:l.plugins.advimage?"mceAdvImage":"mceImage",ui:true});r.addSeparator()}r.add({title:"table.desc",icon:"table",cmd:"mceInsertTable",value:{action:"insert"}});r.add({title:"table.props_desc",icon:"table_props",cmd:"mceInsertTable"});r.add({title:"table.del",icon:"delete_table",cmd:"mceTableDelete"});r.addSeparator();w=r.addMenu({title:"table.cell"});w.add({title:"table.cell_desc",icon:"cell_props",cmd:"mceTableCellProps"});w.add({title:"table.split_cells_desc",icon:"split_cells",cmd:"mceTableSplitCells"});w.add({title:"table.merge_cells_desc",icon:"merge_cells",cmd:"mceTableMergeCells"});w=r.addMenu({title:"table.row"});w.add({title:"table.row_desc",icon:"row_props",cmd:"mceTableRowProps"});w.add({title:"table.row_before_desc",icon:"row_before",cmd:"mceTableInsertRowBefore"});w.add({title:"table.row_after_desc",icon:"row_after",cmd:"mceTableInsertRowAfter"});w.add({title:"table.delete_row_desc",icon:"delete_row",cmd:"mceTableDeleteRow"});w.addSeparator();w.add({title:"table.cut_row_desc",icon:"cut",cmd:"mceTableCutRow"});w.add({title:"table.copy_row_desc",icon:"copy",cmd:"mceTableCopyRow"});w.add({title:"table.paste_row_before_desc",icon:"paste",cmd:"mceTablePasteRowBefore"}).setDisabled(!k);w.add({title:"table.paste_row_after_desc",icon:"paste",cmd:"mceTablePasteRowAfter"}).setDisabled(!k);w=r.addMenu({title:"table.col"});w.add({title:"table.col_before_desc",icon:"col_before",cmd:"mceTableInsertColBefore"});w.add({title:"table.col_after_desc",icon:"col_after",cmd:"mceTableInsertColAfter"});w.add({title:"table.delete_col_desc",icon:"delete_col",cmd:"mceTableDeleteCol"})}else{r.add({title:"table.desc",icon:"table",cmd:"mceInsertTable"})}})}if(!a.isIE){function m(){var r;for(r=l.getBody().lastChild;r&&r.nodeType==3&&!r.nodeValue.length;r=r.previousSibling){}if(r&&r.nodeName=="TABLE"){l.dom.add(l.getBody(),"p",null,'<br mce_bogus="1" />')}}if(a.isGecko){l.onKeyDown.add(function(s,u){var r,t,v=s.dom;if(u.keyCode==37||u.keyCode==38){r=s.selection.getRng();t=v.getParent(r.startContainer,"table");if(t&&s.getBody().firstChild==t){if(c(r,t)){r=v.createRng();r.setStartBefore(t);r.setEndBefore(t);s.selection.setRng(r);u.preventDefault()}}}})}l.onKeyUp.add(m);l.onSetContent.add(m);l.onVisualAid.add(m);l.onPreProcess.add(function(r,t){var s=t.node.lastChild;if(s&&s.childNodes.length==1&&s.firstChild.nodeName=="BR"){r.dom.remove(s)}});m()}});d({mceTableSplitCells:function(l){l.split()},mceTableMergeCells:function(m){var n,o,l;l=e.dom.getParent(e.selection.getNode(),"th,td");if(l){n=l.rowSpan;o=l.colSpan}if(!e.dom.select("td.mceSelected,th.mceSelected").length){h.open({url:f+"/merge_cells.htm",width:240+parseInt(e.getLang("table.merge_cells_delta_width",0)),height:110+parseInt(e.getLang("table.merge_cells_delta_height",0)),inline:1},{rows:n,cols:o,onaction:function(p){m.merge(l,p.cols,p.rows)},plugin_url:f})}else{m.merge()}},mceTableInsertRowBefore:function(l){l.insertRow(true)},mceTableInsertRowAfter:function(l){l.insertRow()},mceTableInsertColBefore:function(l){l.insertCol(true)},mceTableInsertColAfter:function(l){l.insertCol()},mceTableDeleteCol:function(l){l.deleteCols()},mceTableDeleteRow:function(l){l.deleteRows()},mceTableCutRow:function(l){k=l.cutRows()},mceTableCopyRow:function(l){k=l.copyRows()},mceTablePasteRowBefore:function(l){l.pasteRows(k,true)},mceTablePasteRowAfter:function(l){l.pasteRows(k)},mceTableDelete:function(l){l.deleteTable()}},function(m,l){e.addCommand(l,function(){var n=j();if(n){m(n);e.execCommand("mceRepaint");g()}})});d({mceInsertTable:function(l){h.open({url:f+"/table.htm",width:400+parseInt(e.getLang("table.table_delta_width",0)),height:320+parseInt(e.getLang("table.table_delta_height",0)),inline:1},{plugin_url:f,action:l?l.action:0})},mceTableRowProps:function(){h.open({url:f+"/row.htm",width:400+parseInt(e.getLang("table.rowprops_delta_width",0)),height:295+parseInt(e.getLang("table.rowprops_delta_height",0)),inline:1},{plugin_url:f})},mceTableCellProps:function(){h.open({url:f+"/cell.htm",width:400+parseInt(e.getLang("table.cellprops_delta_width",0)),height:295+parseInt(e.getLang("table.cellprops_delta_height",0)),inline:1},{plugin_url:f})}},function(m,l){e.addCommand(l,function(n,o){m(o)})})}});a.PluginManager.add("table",a.plugins.TablePlugin)})(tinymce);