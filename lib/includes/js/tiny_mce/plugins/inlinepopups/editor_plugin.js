(function(){var d=tinymce.DOM,b=tinymce.dom.Element,a=tinymce.dom.Event,e=tinymce.each,c=tinymce.is;tinymce.create("tinymce.plugins.InlinePopups",{init:function(f,g){f.onBeforeRenderUI.add(function(){f.windowManager=new tinymce.InlineWindowManager(f);d.loadCSS(g+"/skins/"+(f.settings.inlinepopups_skin||"clearlooks2")+"/window.css")})},getInfo:function(){return{longname:"InlinePopups",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/inlinepopups",version:tinymce.majorVersion+"."+tinymce.minorVersion}}});tinymce.create("tinymce.InlineWindowManager:tinymce.WindowManager",{InlineWindowManager:function(f){var g=this;g.parent(f);g.zIndex=300000;g.count=0;g.windows={}},open:function(v,k){var A=this,l,j="",s=A.editor,g=0,x=0,i,n,q,r,m,y,z;v=v||{};k=k||{};if(!v.inline){return A.parent(v,k)}if(!v.type){A.bookmark=s.selection.getBookmark(1)}l=d.uniqueId();i=d.getViewPort();v.width=parseInt(v.width||320);v.height=parseInt(v.height||240)+(tinymce.isIE?8:0);v.min_width=parseInt(v.min_width||150);v.min_height=parseInt(v.min_height||100);v.max_width=parseInt(v.max_width||2000);v.max_height=parseInt(v.max_height||2000);v.left=v.left||Math.round(Math.max(i.x,i.x+(i.w/2)-(v.width/2)));v.top=v.top||Math.round(Math.max(i.y,i.y+(i.h/2)-(v.height/2)));v.movable=v.resizable=true;k.mce_width=v.width;k.mce_height=v.height;k.mce_inline=true;k.mce_window_id=l;k.mce_auto_focus=v.auto_focus;A.features=v;A.params=k;A.onOpen.dispatch(A,v,k);if(v.type){j+=" mceModal";if(v.type){j+=" mce"+v.type.substring(0,1).toUpperCase()+v.type.substring(1)}v.resizable=false}if(v.statusbar){j+=" mceStatusbar"}if(v.resizable){j+=" mceResizable"}if(v.minimizable){j+=" mceMinimizable"}if(v.maximizable){j+=" mceMaximizable"}if(v.movable){j+=" mceMovable"}A._addAll(d.doc.body,["div",{id:l,"class":(s.settings.inlinepopups_skin||"clearlooks2")+(tinymce.isIE&&window.getSelection?" ie9":""),style:"width:100px;height:100px"},["div",{id:l+"_wrapper","class":"mceWrapper"+j},["div",{id:l+"_top","class":"mceTop"},["div",{"class":"mceLeft"}],["div",{"class":"mceCenter"}],["div",{"class":"mceRight"}],["span",{id:l+"_title"},v.title||""]],["div",{id:l+"_middle","class":"mceMiddle"},["div",{id:l+"_left","class":"mceLeft"}],["span",{id:l+"_content"}],["div",{id:l+"_right","class":"mceRight"}]],["div",{id:l+"_bottom","class":"mceBottom"},["div",{"class":"mceLeft"}],["div",{"class":"mceCenter"}],["div",{"class":"mceRight"}],["span",{id:l+"_status"},"Content"]],["a",{"class":"mceMove",tabindex:"-1",href:"javascript:;"}],["a",{"class":"mceMin",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{"class":"mceMax",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{"class":"mceMed",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{"class":"mceClose",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{id:l+"_resize_n","class":"mceResize mceResizeN",tabindex:"-1",href:"javascript:;"}],["a",{id:l+"_resize_s","class":"mceResize mceResizeS",tabindex:"-1",href:"javascript:;"}],["a",{id:l+"_resize_w","class":"mceResize mceResizeW",tabindex:"-1",href:"javascript:;"}],["a",{id:l+"_resize_e","class":"mceResize mceResizeE",tabindex:"-1",href:"javascript:;"}],["a",{id:l+"_resize_nw","class":"mceResize mceResizeNW",tabindex:"-1",href:"javascript:;"}],["a",{id:l+"_resize_ne","class":"mceResize mceResizeNE",tabindex:"-1",href:"javascript:;"}],["a",{id:l+"_resize_sw","class":"mceResize mceResizeSW",tabindex:"-1",href:"javascript:;"}],["a",{id:l+"_resize_se","class":"mceResize mceResizeSE",tabindex:"-1",href:"javascript:;"}]]]);d.setStyles(l,{top:-10000,left:-10000});if(tinymce.isGecko){d.setStyle(l,"overflow","auto")}if(!v.type){g+=d.get(l+"_left").clientWidth;g+=d.get(l+"_right").clientWidth;x+=d.get(l+"_top").clientHeight;x+=d.get(l+"_bottom").clientHeight}d.setStyles(l,{top:v.top,left:v.left,width:v.width+g,height:v.height+x});z=v.url||v.file;if(z){if(tinymce.relaxedDomain){z+=(z.indexOf("?")==-1?"?":"&")+"mce_rdomain="+tinymce.relaxedDomain}z=tinymce._addVer(z)}if(!v.type){d.add(l+"_content","iframe",{id:l+"_ifr",src:'javascript:""',frameBorder:0,style:"border:0;width:10px;height:10px"});d.setStyles(l+"_ifr",{width:v.width,height:v.height});d.setAttrib(l+"_ifr","src",z)}else{d.add(l+"_wrapper","a",{id:l+"_ok","class":"mceButton mceOk",href:"javascript:;",onmousedown:"return false;"},"Ok");if(v.type=="confirm"){d.add(l+"_wrapper","a",{"class":"mceButton mceCancel",href:"javascript:;",onmousedown:"return false;"},"Cancel")}d.add(l+"_middle","div",{"class":"mceIcon"});d.setHTML(l+"_content",v.content.replace("\n","<br />"));if(v.type=="confirm"||v.type=="alert"){var o=d.get(l+"_content").clientHeight;o+=d.get(l+"_top").clientHeight;o+=d.get(l+"_bottom").clientHeight;o+=d.get(l+"_ok").clientHeight;o+=30+(tinymce.isIE?8:0);d.setStyles(l,{height:o})}}q=a.add(l,"mousedown",function(p){var t=p.target,f,h;f=A.windows[l];A.focus(l);if(t.nodeName=="A"||t.nodeName=="a"){if(t.className=="mceMax"){f.oldPos=f.element.getXY();f.oldSize=f.element.getSize();h=d.getViewPort();h.w-=2;h.h-=2;f.element.moveTo(h.x,h.y);f.element.resizeTo(h.w,h.h);d.setStyles(l+"_ifr",{width:h.w-f.deltaWidth,height:h.h-f.deltaHeight});d.addClass(l+"_wrapper","mceMaximized")}else{if(t.className=="mceMed"){f.element.moveTo(f.oldPos.x,f.oldPos.y);f.element.resizeTo(f.oldSize.w,f.oldSize.h);f.iframeElement.resizeTo(f.oldSize.w-f.deltaWidth,f.oldSize.h-f.deltaHeight);d.removeClass(l+"_wrapper","mceMaximized")}else{if(t.className=="mceMove"){return A._startDrag(l,p,t.className)}else{if(d.hasClass(t,"mceResize")){return A._startDrag(l,p,t.className.substring(13))}}}}}});r=a.add(l,"click",function(f){var h=f.target;A.focus(l);if(h.nodeName=="A"||h.nodeName=="a"){switch(h.className){case"mceClose":A.close(null,l);return a.cancel(f);case"mceButton mceOk":case"mceButton mceCancel":v.button_func(h.className=="mceButton mceOk");return a.cancel(f)}}});y=A.windows[l]={id:l,mousedown_func:q,click_func:r,element:new b(l,{blocker:1,container:s.getContainer()}),iframeElement:new b(l+"_ifr"),features:v,deltaWidth:g,deltaHeight:x};y.iframeElement.on("focus",function(){A.focus(l)});if(A.count==0&&A.editor.getParam("dialog_type","modal")=="modal"){d.add(d.doc.body,"div",{id:"mceModalBlocker","class":(A.editor.settings.inlinepopups_skin||"clearlooks2")+"_modalBlocker",style:{zIndex:A.zIndex-1}});d.show("mceModalBlocker")}else{d.setStyle("mceModalBlocker","z-index",A.zIndex-1)}if(tinymce.isIE6||/Firefox\/2\./.test(navigator.userAgent)||(tinymce.isIE&&!d.boxModel)){d.setStyles("mceModalBlocker",{position:"absolute",left:i.x,top:i.y,width:i.w-2,height:i.h-2})}A.focus(l);A._fixIELayout(l,1);if(d.get(l+"_ok")){d.get(l+"_ok").focus()}A.count++;return y},focus:function(h){var g=this,f;if(f=g.windows[h]){f.zIndex=this.zIndex++;f.element.setStyle("zIndex",f.zIndex);f.element.update();h=h+"_wrapper";d.removeClass(g.lastId,"mceFocus");d.addClass(h,"mceFocus");g.lastId=h}},_addAll:function(k,h){var g,l,f=this,j=tinymce.DOM;if(c(h,"string")){k.appendChild(j.doc.createTextNode(h))}else{if(h.length){k=k.appendChild(j.create(h[0],h[1]));for(g=2;g<h.length;g++){f._addAll(k,h[g])}}}},_startDrag:function(v,G,F){var o=this,x,B,D=d.doc,f,l=o.windows[v],h=l.element,z=h.getXY(),u,q,E,g,A,s,r,j,i,m,k,n,C;g={x:0,y:0};A=d.getViewPort();A.w-=2;A.h-=2;j=G.screenX;i=G.screenY;m=k=n=C=0;x=a.add(D,"mouseup",function(p){a.remove(D,"mouseup",x);a.remove(D,"mousemove",B);if(f){f.remove()}h.moveBy(m,k);h.resizeBy(n,C);q=h.getSize();d.setStyles(v+"_ifr",{width:q.w-l.deltaWidth,height:q.h-l.deltaHeight});o._fixIELayout(v,1);return a.cancel(p)});if(F!="Move"){y()}function y(){if(f){return}o._fixIELayout(v,0);d.add(D.body,"div",{id:"mceEventBlocker","class":"mceEventBlocker "+(o.editor.settings.inlinepopups_skin||"clearlooks2"),style:{zIndex:o.zIndex+1}});if(tinymce.isIE6||(tinymce.isIE&&!d.boxModel)){d.setStyles("mceEventBlocker",{position:"absolute",left:A.x,top:A.y,width:A.w-2,height:A.h-2})}f=new b("mceEventBlocker");f.update();u=h.getXY();q=h.getSize();s=g.x+u.x-A.x;r=g.y+u.y-A.y;d.add(f.get(),"div",{id:"mcePlaceHolder","class":"mcePlaceHolder",style:{left:s,top:r,width:q.w,height:q.h}});E=new b("mcePlaceHolder")}B=a.add(D,"mousemove",function(w){var p,H,t;y();p=w.screenX-j;H=w.screenY-i;switch(F){case"ResizeW":m=p;n=0-p;break;case"ResizeE":n=p;break;case"ResizeN":case"ResizeNW":case"ResizeNE":if(F=="ResizeNW"){m=p;n=0-p}else{if(F=="ResizeNE"){n=p}}k=H;C=0-H;break;case"ResizeS":case"ResizeSW":case"ResizeSE":if(F=="ResizeSW"){m=p;n=0-p}else{if(F=="ResizeSE"){n=p}}C=H;break;case"mceMove":m=p;k=H;break}if(n<(t=l.features.min_width-q.w)){if(m!==0){m+=n-t}n=t}if(C<(t=l.features.min_height-q.h)){if(k!==0){k+=C-t}C=t}n=Math.min(n,l.features.max_width-q.w);C=Math.min(C,l.features.max_height-q.h);m=Math.max(m,A.x-(s+A.x));k=Math.max(k,A.y-(r+A.y));m=Math.min(m,(A.w+A.x)-(s+q.w+A.x));k=Math.min(k,(A.h+A.y)-(r+q.h+A.y));if(m+k!==0){if(s+m<0){m=0}if(r+k<0){k=0}E.moveTo(s+m,r+k)}if(n+C!==0){E.resizeTo(q.w+n,q.h+C)}return a.cancel(w)});return a.cancel(G)},resizeBy:function(g,h,i){var f=this.windows[i];if(f){f.element.resizeBy(g,h);f.iframeElement.resizeBy(g,h)}},close:function(j,l){var h=this,g,k=d.doc,f=0,i,l;l=h._findId(l||j);if(!h.windows[l]){h.parent(j);return}h.count--;if(h.count==0){d.remove("mceModalBlocker")}if(g=h.windows[l]){h.onClose.dispatch(h);a.remove(k,"mousedown",g.mousedownFunc);a.remove(k,"click",g.clickFunc);a.clear(l);a.clear(l+"_ifr");d.setAttrib(l+"_ifr","src",'javascript:""');g.element.remove();delete h.windows[l];e(h.windows,function(m){if(m.zIndex>f){i=m;f=m.zIndex}});if(i){h.focus(i.id)}}},setTitle:function(f,g){var h;f=this._findId(f);if(h=d.get(f+"_title")){h.innerHTML=d.encode(g)}},alert:function(g,f,j){var i=this,h;h=i.open({title:i,type:"alert",button_func:function(k){if(f){f.call(k||i,k)}i.close(null,h.id)},content:d.encode(i.editor.getLang(g,g)),inline:1,width:400,height:250})},confirm:function(g,f,j){var i=this,h;h=i.open({title:i,type:"confirm",button_func:function(k){if(f){f.call(k||i,k)}i.close(null,h.id)},content:d.encode(i.editor.getLang(g,g)),inline:1,width:400,height:250})},_findId:function(f){var g=this;if(typeof(f)=="string"){return f}e(g.windows,function(h){var i=d.get(h.id+"_ifr");if(i&&f==i.contentWindow){f=h.id;return false}});return f},_fixIELayout:function(i,h){var f,g;if(!tinymce.isIE6){return}e(["n","s","w","e","nw","ne","sw","se"],function(j){var k=d.get(i+"_resize_"+j);d.setStyles(k,{width:h?k.clientWidth:"",height:h?k.clientHeight:"",cursor:d.getStyle(k,"cursor",1)});d.setStyle(i+"_bottom","bottom","-1px");k=0});if(f=this.windows[i]){f.element.hide();f.element.show();e(d.select("div,a",i),function(k,j){if(k.currentStyle.backgroundImage!="none"){g=new Image();g.src=k.currentStyle.backgroundImage.replace(/url\(\"(.+)\"\)/,"$1")}});d.get(i).style.filter=""}}});tinymce.PluginManager.add("inlinepopups",tinymce.plugins.InlinePopups)})();